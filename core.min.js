msos.version=new msos.set_version(14,3,17);msos.console.info("msos/core -> start, "+msos.version);msos.console.time("core");msos.clear_storage=function(){"use strict";var _1="msos.clear_storage -> ";msos.console.debug(_1+"start.");if(Modernizr.sessionstorage){sessionStorage.clear();}if(Modernizr.localstorage){localStorage.clear();}msos.console.debug(_1+"done!");};if(msos.config.clear_storage){msos.clear_storage();}msos.bandwidth_env=function(){"use strict";var _2="msos.bandwidth_env -> ",_3=msos.config.storage.sessionstorage.site_bdwd.name,_4=msos.config.cookie.site_bdwd.value||"na",_5="",_6="";msos.console.debug(_2+"start, sessionStorage: "+(Modernizr.sessionstorage?"enabled":"disabled")+", cookies: "+(navigator.cookieEnabled?"enabled":"disabled"));if(Modernizr.sessionstorage&&navigator.cookieEnabled){_5=sessionStorage.getItem(_3)||"na";if(_4==="na"&&_5==="na"){_6+=", new user!";}else{if(_5==="na"){msos.config.cache=false;_6+=", return user!";}else{_6+=", continuing user!";}}}msos.console.debug(_2+"done, ajax caching set: "+(msos.config.cache?"true":"false")+_6);};msos.bandwidth_env();msos.byid=function(id,_7){"use strict";var _8="msos.byid -> ",_9=null,_a=null;if(_7){_9=_7;}else{_9=window.document;}if(typeof id!=="string"){msos.console.error(_8+"input not an id string!");return null;}_a=jQuery("#"+id,_9)[0];if(_.isElement(_a)){return _a;}msos.console.warn(_8+"na: "+id);return null;};msos.set_display_size=function(){"use strict";var _b="msos.set_display_size -> ",_c=new msos.loader(),_d=function(){var j=0,_e=msos.ondisplay_size_change;for(j=0;j<_e.length;j+=1){_e[j]();}};msos.console.debug(_b+"start.");_c.toggle_css=msos.config.size_array;_c.add_resource_onload.push(function(){setTimeout(_d,150);});_c.load(msos.config.size,msos.resource_url("css","size/"+msos.config.size+".css"));msos.console.debug(_b+"done: "+msos.config.size);};msos.run_onresize=function(){"use strict";var _f="msos.run_onresize -> ",_10=msos.config.view_port.width,m=0;msos.get_viewport(window);msos.console.debug(_f+"start.");for(m=0;m<msos.onresize_functions.length;m+=1){msos.onresize_functions[m]();}msos.console.debug(_f+"done, orig. w: "+_10+", new w: "+msos.config.view_port.width+", for: "+m+" functions.");};msos.run_onorientationchange=function(){"use strict";var _11="msos.run_onorientationchange -> ",_12=msos.config.view_port.width,_13=msos.config.view_orientation,m=0;msos.console.debug(_11+"start, new: "+window.orientation+", pre: "+_13.numeric);if(window.orientation===_13.numeric){msos.console.debug(_11+"done, no change.");return;}jQuery("#body").fadeOut("fast");if(window.orientation===0||window.orientation===180){jQuery(msos.body).css("min-height",_12+"px");}msos.browser_orientation();msos.get_display_size();msos.set_display_size();for(m=0;m<msos.onorientationchange_functions.length;m+=1){msos.onorientationchange_functions[m]();}setTimeout(function(){jQuery("#body").fadeIn("slow");},250);msos.console.debug(_11+"done, orig. w: "+_12+", new w: "+msos.config.view_port.width+", for: "+m+" functions.");};msos.provide=function(_14){"use strict";var _15="msos.provide -> ",_16=_14.replace(/\./g,"_");if(msos.registered_modules[_16]){msos.console.warn(_15+"already registered: "+_14);}else{msos.registered_modules[_16]=true;}msos.console.debug(_15+"executing: "+_14);};msos.require=function(_17,_18){"use strict";var _19="msos.require -> ",_1a="",_1b=_17.split("."),_1c=_1b[0],_1d=null,_1e=null,_1f=null,uri="";if(!/^[0-9a-zA-Z.-]+$/.test(_17)){msos.console.error(_19+"name not allowed: "+_17);return;}_1a=_17.replace(/\./g,"_");if(typeof msos.registered_modules[_1a]==="boolean"){if(msos.registered_modules[_1a]===true){if(_.isFunction(_18)){_18();}}return;}msos.registered_modules[_1a]=false;_1d=function(){if(msos.registered_modules[_1a]){msos.console.debug(_19+"success: "+_17);}else{msos.console.error(_19+"failed: "+_17);}};if(!msos.registered_folders[_1c]){msos.console.debug(_19+"auto resolving module base: "+_1c);msos.registered_folders[_1c]=msos.resource_url(_1c,"");}msos.gen_namespace(_17);if(_1b[0]==="msos"&&_1b[1]==="i18n"){if(_1b.length>2){if(msos.config.verbose){msos.console.debug(_19+"i18n request for: "+_17);}if(typeof msos.registered_modules.msos_i18n!=="boolean"){_1b.splice(2);_17=_1b.join(".");_1a=_1b.join("_");msos.registered_modules.msos_i18n=false;}else{return;}}}_1b.shift();uri=msos.registered_folders[_1c]+_1b.join("/")+".js";msos.require_queue+=1;if(msos.config.verbose){msos.console.debug(_19+"request for module: "+uri+", queue: "+msos.require_queue);}_1e=function(){msos.console.debug(_19+"found: "+_17+", queue: "+msos.require_queue);msos.registered_files.ajax[_17]=uri;if(_.isFunction(_18)){_18();}};_1f=function(){msos.console.debug(_19+"completed: "+_17+", queue: "+msos.require_queue);setTimeout(_1d,100);msos.require_queue-=1;};msos.ajax_request(uri,"script",_1e,_1f);};msos.template=function(_20,_21){"use strict";var _22="msos.template -> ",_23=_20.replace(/\./g,"_"),_24=_20.split("."),_25=_24[0],_26=null,_27=null,_28=null,uri="";if(!/^[0-9a-zA-Z.-]+$/.test(_20)){msos.console.error(_22+"name not allowed: "+_20);return;}_26=msos.gen_namespace(_20);if(typeof msos.registered_templates[_23]==="boolean"){if(msos.registered_templates[_23]===true){if(_.isFunction(_21)){_21(_26);}}return;}msos.registered_templates[_23]=false;if(!msos.registered_folders[_25]){msos.console.debug(_22+"auto resolving template base: "+_25);msos.registered_folders[_25]=msos.resource_url(_25,"");}_24.shift();uri=msos.registered_folders[_25]+_24.join("/")+".html";msos.require_queue+=1;if(msos.config.verbose){msos.console.debug(_22+"request for template: "+uri+", queue: "+msos.require_queue);}_27=function(_29){if(typeof _29==="string"&&_29.length>0){_26.text=_29;_26.name=_23;msos.registered_templates[_23]=true;msos.console.debug(_22+"found: "+_20+", queue: "+msos.require_queue);if(_.isFunction(_21)){_21(_26);}}else{_26.text="";msos.console.error(_22+"failed, no data: "+_20+", queue: "+msos.require_queue);}};_28=function(){msos.console.debug(_22+"completed: "+_20+", queue: "+msos.require_queue);msos.require_queue-=1;};msos.ajax_request(uri,"html",_27,_28);};msos.ajax_request=function(_2a,_2b,_2c,_2d){"use strict";var _2e="msos.ajax_request -> ",_2f=msos.generate_url_name(_2a),st=msos.new_time(),_30=function(_31,_32,xhr){if(typeof _31==="string"&&_31.length>0){var et=msos.new_time(),sec=(et-st)/1000,_33=_31.length*8,bps=Math.round(_33/sec),_34=parseInt(bps/1024,10);msos.ajax_loading_kbps[_2f]=_34;}if(msos.config.verbose){msos.console.debug(_2e+"status: "+_32+", data length: "+(_31.length||0));}if(_.isFunction(_2c)){_2c(_31,_32,xhr);}},_35=function(xhr,_36){var _37=xhr.status+", status: "+_36;if(msos.config.verbose){msos.console.debug(_2e+"completed: "+_37);}if(_.isFunction(_2d)){_2d(xhr,_36);}};jQuery.ajax({url:_2a,dataType:_2b,cache:msos.config.cache,success:_30,error:msos.ajax_error,complete:_35});};msos.ajax_error=function(xhr,_38,_39){"use strict";var _3a=_38+": "+_39,_3b="",_3c={};if(msos.i18n&&msos.i18n.common&&msos.i18n.common.bundle){_3c=msos.i18n.common.bundle;}switch(xhr.status){case 200:_3b=_3c.internal||"Internal error";break;case 404:_3b=_3c.input||"Input error";break;case 407:_3b=_3c.authentication||"Authentication error";break;case 500:_3b=_3c.server||"Server error";break;case 504:_3b=_3c.timeout||"Timeout error";break;default:_3b=_3c.unknown||"Unknown error";}_3b+=" ("+(xhr.status||"no status")+")";msos.notify.error(_39,_3b);if(msos.require_queue>0){_3b+=", ref. req. queue "+msos.require_queue;}if(msos.i18n_queue>0){_3b+=", ref. i18n queue "+msos.i18n_queue;}_3b="msos.ajax_error -> failed: "+_3a+", xhr: "+_3b;if(msos.config.verbose){msos.console.error(_3b,xhr);}else{msos.console.error(_3b);}};msos.hide_mobile_url=function(){"use strict";window.scrollTo(0,1);var _3d=window.pageYOffset||(window.document.compatMode==="CSS1Compat"&&window.document.documentElement.scrollTop)||window.document.body.scrollTop||0;msos.console.debug("msos.hide_mobile_url -> called, scrollTop: "+_3d);setTimeout(function(){window.scrollTo(0,_3d===1?0:1);},1);};msos.notify={container:jQuery("<div id='notify_container'></div>"),add:function(){"use strict";var _3e=msos.notify.container;jQuery("body").append(_3e);_3e.position({of:window,my:"center top+60",at:"center top",collision:"none"});_3e.css("position","fixed");},idx:0,queue:[],run:function(){"use strict";var _3f="msos.notify.run -> ",_40=msos.notify,_41=_40.queue[_40.idx];if(_.isObject(_41)){msos.console.debug(_3f+"prepend, idx: "+_40.idx+", type: "+_41.type);_40.container.prepend(_41.note_el);_41.auto_delay=setTimeout(_41.fade_out,_41.delay);_40.idx+=1;}else{msos.console.debug(_3f+"clear, idx: "+_40.idx);_40.idx=0;_40.queue=[];}},base:function(_42,_43,_44,_45,_46){"use strict";var _47="msos.notify.base -> ",_48=msos.notify,_49=String(_48.idx),_4a={type:_42,delay:_46||4000,auto_delay:0,icon_el:null,butt_el:jQuery("<button class='btn btn-danger btn-small fa fa-times'></button>"),note_el:jQuery("<div class='notify'></div>"),disp_el:jQuery("<div class='notify_display'></div>"),titl_el:jQuery("<div class='notify_title'></div>"),msg_el:jQuery("<div class='notify_msg'></div>")};msos.console.debug(_47+"start, idx: "+_48.idx+", type: "+_42);_4a.disp_el.append(_4a.butt_el);if(_45){_4a.icon_el=jQuery(_45);_4a.note_el.append(_4a.icon_el);}if(_44){_4a.titl_el.append(document.createTextNode(_44));_4a.disp_el.append(_4a.titl_el);}if(_43){_4a.msg_el.append(document.createTextNode(_43));_4a.disp_el.append(_4a.msg_el);}_4a.note_el.append(_4a.disp_el);_4a.fade_out=function(){if(_4a.auto_delay===0){_48.idx+=1;}else{clearTimeout(_4a.auto_delay);_4a.note_el.fadeOut("slow",function(){msos.console.debug(_47+"fade_out, idx: "+_49+", type: "+_42);_4a.note_el.remove();msos.notify.run();});}};_4a.butt_el.on("click",_4a.fade_out);if(_48.queue.length===0){_48.queue.push(_4a);_48.run();}else{_48.queue.push(_4a);}msos.console.debug(_47+"done!");return _4a;},info:function(_4b,_4c){"use strict";var obj=new msos.notify.base("info",_4b,_4c,"<i class=\"fa fa-info-circle fa-2x info\">");return obj;},warning:function(_4d,_4e){"use strict";var obj=new msos.notify.base("warning",_4d,_4e,"<i class=\"fa fa-warning fa-2x warning\">",6000);return obj;},error:function(_4f,_50){"use strict";var obj=new msos.notify.base("error",_4f,_50,"<i class=\"fa fa-ban fa-2x error\">",8000);return obj;},success:function(_51,_52){"use strict";var obj=new msos.notify.base("success",_51,_52,"<i class=\"fa fa-check-circle fa-2x success\">");return obj;},loading:function(_53,_54){"use strict";var obj=new msos.notify.base("loading",_53,_54,"<i class=\"fa fa-spinner fa-spin fa-2x loading\">",10000);return obj;}};window.onerror=function(msg,url,_55){"use strict";var _56="JavaScript Error!";msos.console.error("window.onerror -> fired, line: "+_55+", url: "+url+", error: "+msg);if(msos.i18n&&msos.i18n.common&&msos.i18n.common.bundle){_56=msos.i18n.common.bundle.error||_56;}msos.notify.error(msg,_56);return true;};msos.check_deferred_scripts=function(){"use strict";var _57="msos.check_deferred_scripts -> ",_58=true,_59=msos.registered_files.js,_5a="",_5b="";msos.require_deferred+=1;for(_5b in _59){_5a=_59[_5b].getAttribute("defer")||false;if(_5a&&_59[_5b].msos_load_state!=="loaded"){_58=false;msos.console.debug(_57+"still loading: "+_5b+", attemp: "+msos.require_deferred);}}if(msos.require_deferred>9){if(msos.config.verbose){prompt("A deferred script failed to load. Click OK to continue.");}setTimeout(function(){location.reload();},100);}else{if(_58){if(msos.config.mobile){msos.hide_mobile_url();}msos.set_display_size();msos.notify.add();msos.run_intial();msos.run_onload();}else{setTimeout(msos.check_deferred_scripts,100);}}};msos.check_resources=function(){"use strict";var _5c="msos.check_resources -> ",_5d="",_5e=0,_5f=0,_60=document.getElementsByTagName("script")||[],src,i,_61={modules:"module(s)",files:"file(s)",load_error:"Loading Error!",load_failed:"failed to load."},key="",_62="";for(_5d in msos.registered_modules){if(!msos.registered_modules[_5d]){msos.console.error(_5c+"module failed to load: "+(_5d.replace(/_/g,".")));_5e+=1;}}for(i=0;i<_60.length;i+=1){if(_60[i].readyState&&(_60[i].readyState!=="loaded"||_60[i].readyState!=="complete")){src=_60[i].getAttribute("src")||"";if(src){msos.console.error(_5c+"file failed to load: "+src);_5f+=1;}}}if(_5e>0||_5f>0){if(msos.i18n&&msos.i18n.common&&msos.i18n.common.bundle){for(key in _61){if(msos.i18n.common.bundle[key]){_61[key]=msos.i18n.common.bundle[key];}}}if(_5e>0){_62+=_5e+" "+_61.modules;_62+=_5f>0?", ":"";}if(_5f>0){_62+=_5f+" "+_61.files;}_62+=" "+_61.load_failed;msos.notify.error(_62,_61.load_error);}};msos.set_bandwidth=function(){"use strict";var _63="msos.set_bandwidth -> ",_64="",cfg=msos.config,_65=cfg.storage.sessionstorage.site_bdwd,_66=cfg.cookie.site_bdwd.value||"na",_67=msos.ajax_loading_kbps,_68={},_69="",_6a=false,cnt=0,sum=0,avg=0,i=0;if(cfg.clear_cookies){_64=", cleared cookies";}if(cfg.clear_storage){_64+=", cleared storage";}if(cfg.clear_cookies&&cfg.clear_storage){msos.console.warn(_63+"simulated new user: browser cache cleared?");}if(cfg.verbose){_64+=", request ajax bandwidth: ";msos.console.debug(_63+"start"+_64,_67);}else{_64+=".";msos.console.debug(_63+"start"+_64);}if(Modernizr.sessionstorage&&navigator.cookieEnabled){msos.console.debug(_63+"using sessionStorage!");_68=sessionStorage.getItem(_65.name)?JSON.parse(sessionStorage.getItem(_65.name)):{};if(cfg.verbose){msos.console.debug(_63+"sessionStorage bandwidth: ",_68);}for(_69 in _67){_68[_69]=_67[_69];_6a=true;}if(_6a){msos.console.debug(_63+"new value(s) added!");for(_69 in _68){sum+=parseInt(_68[_69],10);cnt+=1;}avg=sum/cnt;_65.value=JSON.stringify(_68);sessionStorage.setItem(_65.name,_65.value);_65.set=true;}else{msos.console.debug(_63+"no new values, use cookie!");avg=_66!=="na"?_66:10;}}else{if(_66==="na"&&navigator.cookieEnabled){msos.console.debug(_63+"use current loading data!");for(i=0;i<_67.length;i+=1){sum+=parseInt(_67[i],10);}avg=_67.length?(sum/_67.length):10;}else{msos.console.debug(_63+"use previous cookie or default!");avg=_66!=="na"?_66:10;}}cfg.cookie.site_bdwd.value=parseInt(avg,10);cfg.cookie.site_bdwd.set=true;msos.console.debug(_63+"done, bandwidth: "+parseInt(avg,10));};msos.connection=function(){"use strict";var _6b="msos.connection -> ",_6c=navigator.connection||{type:0,bandwidth:0,metered:false},_6d=msos.config.connection,_6e="na",_6f=0,_70=function(val,low,_71){return low<_71?val>=low&&val<=_71:val>=_71&&this<=low;};if(msos.config.verbose){msos.console.debug(_6b+"start, nav. input: ",_6c);}if(!msos.config.cookie.site_bdwd.set){msos.console.warn(_6b+"calc'd bandwidth not available yet!");}if(_6c.bandwidth&&!msos.var_is_empty(_6c.bandwidth)){_6f=_6c.bandwidth;}else{_6f=msos.config.cookie.site_bdwd.value||10;}if(_6c.type===1){_6e="fast";}if(_6c.type===2){_6e="fast";}if(/wifi|ethernet/i.test(_6c.type)){_6e="fast";}if(_6c.type===3||/2g$/i.test(_6c.type)){_6e="2g";}if(_6c.type===4||/3g$/i.test(_6c.type)){_6e="3g";}if(/4g$/i.test(_6c.type)){_6e="4g";}if(_6e==="na"){_6e=_70(_6f,1,50)?"slow":_70(_6f,51,150)?"2g":_70(_6f,151,600)?"3g":_70(_6f,601,1000)?"4g":"fast";}_6d.type=_6e;_6d.bandwidth=_6f;_6d.metered=_6c.metered?true:false;if(msos.config.verbose){msos.console.debug(_6b+"done, output: ",_6d);}};msos.set_window_onchange=function(){"use strict";var _72="msos.set_window_onchange -> ";msos.console.debug(_72+"start.");if(msos.onresize_functions.length>0){jQuery(window).on("resize",_.throttle(msos.run_onresize,200));}if(msos.config.orientation&&msos.config.orientation_change){jQuery(window).on("orientationchange",_.debounce(msos.run_onorientationchange,300,true));}msos.console.debug(_72+"done!");};msos.run_intial=function(){"use strict";var _73="msos.run_intial -> ",cfg=msos.config,req=msos.require;msos.console.debug(_73+"start.");msos.body=window.document.body||window.document.getElementsByTagName("body")[0];msos.head=msos.get_head(window);msos.html=window.document.getElementsByTagName("html")[0];msos.docl=document.compatMode==="BackCompat"?window.document.body:window.document.documentElement;msos.browser_direction();if(cfg.visualevent){req("msos.visualevent");}if(cfg.mobile){req("msos.mobile");}if(cfg.run_onerror){req("msos.onerror");}if(cfg.debug_output){req("msos.debug");}if(cfg.console){req("msos.pyromane");}msos.console.debug(_73+"done!");};msos.run_final=function(){"use strict";var _74="msos.run_final";msos.console.debug(_74+" -> start.");msos.run_function_array("onload_func_post");msos.set_locale_cookie();if(msos.debug){msos.debug.timing();}msos.console.debug(_74+" -> done!");if(msos.pyromane){setTimeout(msos.pyromane.run,500);}msos.run_onload_incr+=1;};msos.run_onload_incr=1;msos.run_onload=function(){"use strict";var _75="msos.run_onload ("+msos.run_onload_incr+") =====> ",cfg=msos.config,_76=100,_77=_76/1000,_78,cc=cfg.cookie;if(msos.require_attempts===0){msos.console.time("run_onload");if(cfg.verbose){msos.console.debug(_75+"start.",cfg);}else{msos.console.debug(_75+"start.");}msos.run_function_array("onload_func_pre");setTimeout(msos.run_onload,_76);msos.require_attempts+=1;return;}if(msos.require_queue===0&&msos.i18n&&!msos.i18n.done){msos.i18n.module_add();msos.i18n.done=true;setTimeout(msos.run_onload,_76);msos.require_attempts+=1;return;}if(msos.require_queue===0&&msos.i18n_queue===0&&!cc.site_bdwd.set){msos.set_bandwidth();msos.connection();msos.set_window_onchange();msos.cookie(cc.site_pref.name,cc.site_pref.value,cc.site_pref.params);cc.site_pref.set=true;msos.cookie(cc.site_bdwd.name,cc.site_bdwd.value,cc.site_bdwd.params);setTimeout(msos.run_onload,_76);msos.require_attempts+=1;return;}if(msos.require_queue===0&&msos.i18n_queue===0&&msos.onload_func_start.length>0){msos.run_function_array("onload_func_start");setTimeout(msos.run_onload,_76);msos.require_attempts+=1;return;}if(msos.require_queue===0&&msos.i18n_queue===0){msos.run_function_array("onload_functions");msos.run_function_array("onload_func_done");if(cfg.verbose){msos.console.debug(_75+"done, modules and templates: ",msos.registered_modules,msos.registered_templates);}else{msos.console.debug(_75+"done!");}msos.require_attempts=0;if(msos.i18n){msos.i18n.done=false;}msos.console.timeEnd("run_onload");setTimeout(msos.run_final,_76);}else{if(_.indexOf([10,20,40,80,100,100],msos.require_attempts)!==-1){msos.console.warn(_75+"waited: "+(msos.require_attempts*_77)+" secs.");}else{if(msos.require_attempts>100){_78=function(){msos.console.error(_75+"failed, module queue: "+msos.require_queue+", i18n queue: "+msos.i18n_queue);msos.notify.warning(jQuery("title").text(),"Page Timed Out");msos.check_resources();};setTimeout(_78,400);return;}}setTimeout(msos.run_onload,_76);msos.require_attempts+=1;}};jQuery(document).ready(msos.check_deferred_scripts);msos.registered_modules.msos=true;msos.console.info("msos/core -> done!");msos.console.timeEnd("core");